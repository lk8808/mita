<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
		<link rel="stylesheet" type="text/css" href="/lib/mui/css/mui.min.css"/>
		<script type="text/javascript" src="/lib/mui/js/mui.min.js"></script>
		<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
		<style type="text/css">
            .mui-input-row label {
                padding: 10px 5px;
            }
        </style>
	</head>
	<body>
	   <header class="mui-bar mui-bar-nav">
           <button id="btn_back" class="mui-btn mui-btn-blue mui-btn-link mui-pull-left">
               <span class="mui-icon mui-icon-back"></span>返回
           </button>
           <h1 class="mui-title">录入信息</h1>
       </header>
	   <div id="content" class="mui-content">
	       <form id="bizdataForm" >
	       <h5 style="padding:5px;text-align:center;">参会公司信息</h5>
	       <div class="mui-input-group">
		       <div class="mui-input-row">
		           <label>单位名称</label>
	               <input id="compname" name="compname" type="text" class="mui-input-clear" placeholder="请输入单位名称">
		       </div>
		       <div class="mui-input-row">
                   <label>单位地址</label>
                   <input id="compname" name="compaddr" type="text" class="mui-input-clear" placeholder="请输入单位地址">
               </div>
		       <div class="mui-input-row">
		           <label>预计到达日期</label>
                   <input id="arrivedate" name="arrivedate" type="date" >
		       </div>
		       <div class="mui-input-row">
		           <label>参会人数</label>
                   <div class="mui-numbox">
					  <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
					  <input id="pernum" name="pernum" class="mui-numbox-input" type="number" />
					  <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
				   </div>
		       </div>
		       <div class="mui-input-row">
		           <label>预定单间数量</label>
                   <div class="mui-numbox">
                      <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
                      <input id="singlenum" name="singlenum" class="mui-numbox-input" type="number" />
                      <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
                   </div>
               </div>
               <div class="mui-input-row">
                   <label>预定标间数量</label>
                   <div class="mui-numbox">
                      <button class="mui-btn mui-numbox-btn-minus" type="button">-</button>
                      <input id="standnum" name="standnum" class="mui-numbox-input" type="number" />
                      <button class="mui-btn mui-numbox-btn-plus" type="button">+</button>
                   </div>
               </div>
	       </div>
	       <div class="mui-button-row">
		        <span id="add" class="mui-btn mui-icon mui-icon-plus mui-btn-success" >点击添加参会人员</span>
		   </div>
	       <div class="mui-card" style="padding:10px;background-color: #f7f7f7;">
	            <ul id="list" class="mui-table-view mui-grid-view">
	            </ul>
	       </div>
	       <button id="btn_save" type="button" class="mui-btn mui-btn-primary" style="margin:20px;width:90%;height:40px;">确认</button>
	       </form>
	   </div>
	</body>
	<script type="text/javascript">
	
	   var pers = 0;
	   var perid = 0;
	   var mask = mui.createMask(function() {});
	
	   mui.init();
	   
	   mui.ready(function() {
           initEvent();
       });
	   
	   function initEvent() {
		   mui("#header").on('tap', '#btn_back', function(){
	       });
	       
	       mui("#content").on('tap', '#add', function(){
	    	   perid = perid + 1;
               var node = document.getElementById("list");
               var li = document.createElement('li');
               li.className = 'mui-table-view-cell mui-media';
               li.setAttribute("id", 'li_per_' + perid);
               var htmlStr = 
            	   '<div class="mui-input-group">' +
		               '<div align="right">' +
		                   '<span id="sp_per_' + perid + '" class="mui-icon mui-icon-close delper" style="color:#007aff;font-size:2em;"></span>' +
		               '</div>' +
		               '<div class="mui-input-row">' +
		                   '<label>姓名：</label>' +
		                   '<input name="tmpdets[' + pers + '].pername" type="text" class="mui-input-clear" placeholder="请输入姓名">' +
		               '</div>' +
		               '<div class="mui-input-row">' +
		                   '<label>职务：</label>' +
		                   '<input name="tmpdets[' + pers + '].pos" type="text" class="mui-input-clear" placeholder="请输入职务">' +
		               '</div>' +
		               '<div class="mui-input-row">' +
		                   '<label>联系电话：</label>' +
		                   '<input name="tmpdets[' + pers + '].telephone" type="text" class="mui-input-clear" placeholder="请输入联系电话">' +
		               '</div>' +
		               '<div class="mui-input-row">' +
		                   '<label>电子邮箱：</label>' +
		                   '<input name="tmpdets[' + pers + '].email" type="text" class="mui-input-clear" placeholder="请输入电子邮箱">' +
		               '</div>' +
		           '</div>' +
		           '<hr/>';
               li.innerHTML = htmlStr;
               node.appendChild(li);
               pers = pers + 1;   
	       });
	       
	       //删除业务品种
           mui("#content").on('tap', '.delper', function(){
               var id = this.id;
               id = id.replace("sp", "li");
               var node = document.getElementById(id);
               node.parentNode.removeChild(node);
               pers = pers - 1;
           });
           
	       //保存信息
           mui("#content").on('tap', '#btn_save', function(){
        	   var data = $('form').serializeArray();
        	   mask.show();
        	   mui.ajax('/tmp/adda',{
        		   data:data,
        		   type:'post',
        		   async:true,
        		   success:function(data){
        			   console.log(data);
        			   if (data.rtsts && data.rtsts.code && data.rtsts.code == '000000') {
        				   //window.location.href = 'end.html';
        				   mui.confirm("提交成功，将关闭页面", "提示", ['确认', '取消'], function(e) {
        					   if (e.index == 1) {
        					   } else {
        						   window.location.href = 'end.html';
        					   }
        				   });
        			   } else {
        				   mui.toast("提交失败");
        			   }
        		   },
        		   error:function(xhr,type,errorThrown){
        		   }
        	   });         	   
           });
	   }
	   
	   function removeWaitStyle() {
		   mask.close();
	   }
	   
	</script>
</html>